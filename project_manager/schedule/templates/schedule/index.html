{% extends "schedule/base.html" %}

{% block javascript %}
<script src="//code.jquery.com/jquery-2.2.0.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['gantt']});
    google.charts.setOnLoadCallback(drawChart);

    function daysToMilliseconds(days) {
      return days * 24 * 60 * 60 * 1000;
    }

    function updateChart(chart, data) {
      var options = {
        height: 275
      };

      var chartData = new google.visualization.DataTable();
      chartData.addColumn('string', 'Task ID');
      chartData.addColumn('string', 'Task Name');
      chartData.addColumn('date', 'Start Date');
      chartData.addColumn('date', 'End Date');
      chartData.addColumn('number', 'Duration');
      chartData.addColumn('number', 'Percent Complete');
      chartData.addColumn('string', 'Dependencies');

    for (row in data) {
    chartData.addRow([data[row].name, data[row].name, new Date(data[row].start_date),
    null, daysToMilliseconds(data[row].duration), 0, data[row].depends_on]);
    }
    
      chart.draw(chartData, options);
    }

    function drawChart() {

      var chart = new google.visualization.Gantt(document.getElementById('chart_div'));

      $.ajax({url: "/schedule/gantt-json",
              success: function(data) {updateChart(chart, data);}});
      
    }
  </script>

{% endblock %}

{% block content %}
<div id="chart_div"></div>

<table>
  <tr>
    <th>Name</th>
    <th>Resource</th>
    <th>Estimate</th>
    <th>Days worked</th>
    <th>Estimate remaining</th>
    <th>Gain</th>
  </tr>
  {% for task in tasks %}
  <tr>
    <td>
      {{ task.name }}
    </td>
    <td>
      {{ task.resource.name }}
    </td>
    <td>
      {{ task.orig_estimate }}
    </td>
    <td>
      {{ task.days_worked }}
    </td>
    <td>
      {{ task.estimate_remaining }}
    </td>
    <td>
      {{ task.gain }}
    </td>
    <td>
      <a href="{% url 'schedule:edit_task' pk=task.id %}">edit</a>
    </td>
  </tr>
  {% endfor %}

  <tr>
    <td colspan="4">
      <a href="{% url 'schedule:add_task' %}">add</a>
    </td>
  </tr>
</table>
{% endblock %}
